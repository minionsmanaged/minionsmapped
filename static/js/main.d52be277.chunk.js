(this.webpackJsonpminionsmapped=this.webpackJsonpminionsmapped||[]).push([[0],{46:function(e,t,n){e.exports=n(63)},51:function(e,t,n){},57:function(e,t,n){},63:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(39),l=n.n(i),a=n(24),s=n(8),c=(n(51),n(17)),p=n(35),u=n(40),f=n(11),d=n(12),h=n(15),m=n(13),v=n(18),k=n(14),g=n(42),y=n(19),w=n(22),b=n(33),j=n(34),O=n(45),I=n(23),x=n(26),E=n(16),W=n(30),C=n(25);Date.prototype.addHours=function(e){return this.setHours(this.getHours()+e),this};var T=function(e){function t(e){var n;Object(f.a)(this,t);var r=(n=Object(h.a)(this,Object(m.a)(t).call(this,e))).props.pool.workerPoolId.split("/");return n.state={instances:[],pending:0,domain:r.length>0?r[0]:"",pool:r.length>1?r[1]:""},n}return Object(k.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.queryTaskcluster();var e=Math.floor(5e4*Math.random())+1e4;this.interval=setInterval(this.queryTaskcluster.bind(this),e)}},{key:"componentWillUnmount",value:function(){clearInterval(this.interval)}},{key:"queryTaskcluster",value:function(){var e=this,t=[];fetch("https://firefox-ci-tc.services.mozilla.com/api/queue/v1/provisioners/"+this.state.domain+"/worker-types/"+this.state.pool+"/workers").then((function(e){return e.json()})).then((function(n){t=t.concat(n.workers),e.setState({instances:t}),"continuationToken"in n&&t.length<e.props.pool.config.maxCapacity&&fetch("https://firefox-ci-tc.services.mozilla.com/api/queue/v1/provisioners/"+e.state.domain+"/worker-types/"+e.state.pool+"/workers?continuationToken="+n.continuationToken).then((function(e){return e.json()})).then((function(n){t=t.concat(n.workers),"continuationToken"in n?fetch("https://firefox-ci-tc.services.mozilla.com/api/queue/v1/provisioners/"+e.state.domain+"/worker-types/"+e.state.pool+"/workers?continuationToken="+n.continuationToken).then((function(e){return e.json()})).then((function(n){t=t.concat(n.workers),e.setState({instances:t}),"continuationToken"in n&&t.length<e.props.pool.config.maxCapacity&&fetch("https://firefox-ci-tc.services.mozilla.com/api/queue/v1/provisioners/"+e.state.domain+"/worker-types/"+e.state.pool+"/workers?continuationToken="+n.continuationToken).then((function(e){return e.json()})).then((function(n){t=t.concat(n.workers),e.setState({instances:t})}))})):e.setState({instances:t})}))})),fetch("https://firefox-ci-tc.services.mozilla.com/api/queue/v1/pending/"+this.state.domain+"/"+this.state.pool).then((function(e){return e.json()})).then((function(t){var n=t.pendingTasks;e.setState({pending:n})}))}},{key:"renderProviderIcon",value:function(){switch(this.props.pool.providerId){case"aws":return o.a.createElement(E.a,{icon:C.a});case"azure":return o.a.createElement(E.a,{icon:C.c});case"null-provider":return o.a.createElement(E.a,{icon:W.b});default:return this.props.pool.providerId.endsWith("-gcp")?o.a.createElement(E.a,{icon:C.b}):o.a.createElement(E.a,{icon:W.a})}}},{key:"render",value:function(){return o.a.createElement(I.a,null,o.a.createElement("strong",null,this.state.domain," / ",this.state.pool," ",this.renderProviderIcon()),o.a.createElement("small",{className:"text-muted font-weight-light float-right"},"\xa0max: ",this.props.pool.config.maxCapacity,", \xa0working: ",this.state.instances.filter((function(e){return"latestTask"in e&&"firstClaim"in e})).length,", \xa0initialising: ",this.state.instances.filter((function(e){return(!("latestTask"in e)||!("firstClaim"in e))&&new Date(e.firstClaim)>(new Date).addHours(-1)})).length,", \xa0pending: ",this.state.pending),o.a.createElement("br",null),o.a.createElement(x.a,null,o.a.createElement(x.a,{striped:!0,variant:"success",now:Math.min(this.props.pool.config.maxCapacity,this.state.instances.filter((function(e){return"latestTask"in e&&"firstClaim"in e})).length),max:this.props.pool.config.maxCapacity,key:1}),o.a.createElement(x.a,{striped:!0,now:Math.min(this.props.pool.config.maxCapacity,this.state.instances.filter((function(e){return(!("latestTask"in e)||!("firstClaim"in e))&&new Date(e.firstClaim)>(new Date).addHours(-1)})).length),max:this.props.pool.config.maxCapacity,key:2})))}}]),t}(r.Component),P=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(h.a)(this,Object(m.a)(t).call(this,e))).state={platforms:n.props.pools.map((function(e){return e.providerId.endsWith("-gcp")?"google":"null-provider"===e.providerId?"deleted":e.providerId})).filter((function(e,t,n){return n.indexOf(e)===t})),providers:n.props.pools.map((function(e){return e.providerId})).filter((function(e,t,n){return n.indexOf(e)===t}))},n}return Object(k.a)(t,e),Object(d.a)(t,[{key:"renderPoolSummaryComponent",value:function(e,t){var n,r;return e.providerId in t.platform?n=e.providerId:e.providerId.endsWith("-gcp")&&(n="google"),r=e.providerId.includes("-level1-")||e.workerPoolId.split("/")[0].endsWith("-1")?"one":e.providerId.includes("-level3-")||e.workerPoolId.split("/")[0].endsWith("-3")?"three":e.providerId.includes("-test-")||e.workerPoolId.split("/")[0].endsWith("-t")?"test":"none",t.platform[n]||t.provider[e.providerId]||t.level[r]?"":o.a.createElement(T,{pool:e,key:e.workerPoolId})}},{key:"render",value:function(){var e=this;return o.a.createElement(j.a,{style:{marginTop:"10px"}},o.a.createElement(j.a.Header,null,o.a.createElement("strong",null,this.props.domain),o.a.createElement("small",{className:"text-muted font-weight-light float-right"},this.props.pools.length," pool",1===this.props.pools.length?"":"s",", \xa0",this.state.platforms.length," platform",1===this.state.platforms.length?"":"s",", \xa0",this.state.providers.length," provider",1===this.state.providers.length?"":"s")),o.a.createElement(O.a,{className:"list-group-flush"},this.props.pools.map((function(t){return e.renderPoolSummaryComponent(t,e.props.filter)}))))}}]),t}(r.Component),z=(n(57),function(e){function t(e){var n;if(Object(f.a)(this,t),n=Object(h.a)(this,Object(m.a)(t).call(this,e)),e.location&&e.location.hash)e.location.hash.replace(/#/,"").split(";").reduce((function(e,t){var n=t.split("=");return e[n[0]]=n[1].split(","),e}),{});return n.state={domains:[],pools:{},filter:e.location&&e.location.hash?Object(u.a)({},{platform:{},provider:{},level:{}},{},e.location.hash.replace(/#/,"").split(";").reduce((function(e,t){var n=t.split("=");return e[n[0]]=n[1].split(",").reduce((function(e,t){return e[["1","3","t"].includes(t)?t.replace("t","test").replace("1","one").replace("3","three"):t]=!1,e}),{}),e}),{})):{platform:{},provider:{},level:{}}},n.queryTaskcluster=n.queryTaskcluster.bind(Object(v.a)(n)),n.handleFilterChange=n.handleFilterChange.bind(Object(v.a)(n)),n}return Object(k.a)(t,e),Object(d.a)(t,[{key:"componentDidMount",value:function(){this.queryTaskcluster()}},{key:"queryTaskcluster",value:function(){var e=this,t=[];fetch("https://firefox-ci-tc.services.mozilla.com/api/worker-manager/v1/worker-pools").then((function(e){return e.json()})).then((function(n){var r=(t=t.concat(n.workerPools)).map((function(e){return e.workerPoolId.split("/")[0]})).filter((function(e,t,n){return n.indexOf(e)===t})),o=t.map((function(e){return e.providerId.endsWith("-gcp")?"google":"null-provider"===e.providerId?"deleted":e.providerId})).filter((function(e,t,n){return n.indexOf(e)===t})).reduce((function(t,n){return t[n]=n in e.state.filter.platform?e.state.filter.platform[n]:!(!e.props.location.hash.includes("platform=")||n in e.state.filter.platform)||(!!e.props.location.hash.includes("platform=")||!(e.props.location.hash.includes("provider=")&&e.props.location.hash.includes("aws")&&"aws"===n||e.props.location.hash.includes("provider=")&&e.props.location.hash.includes("azure")&&"azure"===n||e.props.location.hash.includes("level=")&&e.props.location.hash.includes("test"))),t}),{}),i=t.map((function(e){return e.providerId})).filter((function(e,t,n){return n.indexOf(e)===t})).reduce((function(t,n){return t[n]=n in e.state.filter.provider?e.state.filter.provider[n]:!(!e.props.location.hash.includes("provider=")||n in e.state.filter.provider)||(!!e.props.location.hash.includes("provider=")||(e.props.location.hash.includes("platform=")&&!e.props.location.hash.includes("google")&&n.endsWith("-gcp")||e.props.location.hash.includes("platform=")&&!e.props.location.hash.includes("deleted")&&"null-provider"===n||e.props.location.hash.includes("platform=")&&!e.props.location.hash.includes("aws")&&"aws"===n||e.props.location.hash.includes("platform=")&&!e.props.location.hash.includes("azure")&&"azure"===n||!(e.props.location.hash.includes("level=")&&e.props.location.hash.includes("test")&&!n.includes("-level")))),t}),{}),l=t.map((function(e){return e.providerId.includes("-level1-")||e.workerPoolId.split("/")[0].endsWith("-1")?"one":e.providerId.includes("-level3-")||e.workerPoolId.split("/")[0].endsWith("-3")?"three":e.providerId.includes("-test-")||e.workerPoolId.split("/")[0].endsWith("-t")?"test":"none"})).filter((function(e,t,n){return n.indexOf(e)===t})).reduce((function(t,n){return t[n]=n in e.state.filter.level?e.state.filter.level[n]:!(!e.props.location.hash.includes("level=")||n in e.state.filter.level)||e.props.location.hash.includes("level="),t}),{}),a=Object.assign.apply(Object,[{}].concat(Object(p.a)(r.map((function(e){return Object(c.a)({},e,t.filter((function(t){return t.workerPoolId.startsWith(e+"/")})))})))));"continuationToken"in n?fetch("https://firefox-ci-tc.services.mozilla.com/api/worker-manager/v1/worker-pools?continuationToken="+n.continuationToken).then((function(e){return e.json()})).then((function(n){t=t.concat(n.workerPools),r=t.map((function(e){return e.workerPoolId.split("/")[0]})).filter((function(e,t,n){return n.indexOf(e)===t})),o=t.map((function(e){return e.providerId.endsWith("-gcp")?"google":"null-provider"===e.providerId?"deleted":e.providerId})).filter((function(e,t,n){return n.indexOf(e)===t})).reduce((function(t,n){return t[n]=n in e.state.filter.platform?e.state.filter.platform[n]:!(!e.props.location.hash.includes("platform=")||n in e.state.filter.platform)||(!!e.props.location.hash.includes("platform=")||!(e.props.location.hash.includes("provider=")&&e.props.location.hash.includes("aws")&&"aws"===n||e.props.location.hash.includes("provider=")&&e.props.location.hash.includes("azure")&&"azure"===n||e.props.location.hash.includes("level=")&&e.props.location.hash.includes("test"))),t}),{}),i=t.map((function(e){return e.providerId})).filter((function(e,t,n){return n.indexOf(e)===t})).reduce((function(t,n){return t[n]=n in e.state.filter.provider?e.state.filter.provider[n]:!(!e.props.location.hash.includes("provider=")||n in e.state.filter.provider)||(!!e.props.location.hash.includes("provider=")||(e.props.location.hash.includes("platform=")&&!e.props.location.hash.includes("google")&&n.endsWith("-gcp")||e.props.location.hash.includes("platform=")&&!e.props.location.hash.includes("deleted")&&"null-provider"===n||e.props.location.hash.includes("platform=")&&!e.props.location.hash.includes("aws")&&"aws"===n||e.props.location.hash.includes("platform=")&&!e.props.location.hash.includes("azure")&&"azure"===n||!(e.props.location.hash.includes("level=")&&e.props.location.hash.includes("test")&&!n.includes("-level")))),t}),{}),l=t.map((function(e){return e.providerId.includes("-level1-")||e.workerPoolId.split("/")[0].endsWith("-1")?"one":e.providerId.includes("-level3-")||e.workerPoolId.split("/")[0].endsWith("-3")?"three":e.providerId.includes("-test-")||e.workerPoolId.split("/")[0].endsWith("-t")?"test":"none"})).filter((function(e,t,n){return n.indexOf(e)===t})).reduce((function(t,n){return t[n]=n in e.state.filter.level?e.state.filter.level[n]:!(!e.props.location.hash.includes("level=")||n in e.state.filter.level)||e.props.location.hash.includes("level="),t}),{}),a=Object.assign.apply(Object,[{}].concat(Object(p.a)(r.map((function(e){return Object(c.a)({},e,t.filter((function(t){return t.workerPoolId.startsWith(e+"/")})))}))))),e.setState((function(e){return e.domains=r,e.pools=a,e.filter.platform=o,e.filter.provider=i,e.filter.level=l,e}))})):e.setState((function(e){return e.domains=r,e.pools=a,e.filter.platform=o,e.filter.provider=i,e.filter.level=l,e}))}))}},{key:"renderDomainSummaryComponent",value:function(e,t,n){var r=t.map((function(e){return e.providerId.endsWith("-gcp")?"google":"null-provider"===e.providerId?"deleted":e.providerId})).filter((function(e,t,n){return n.indexOf(e)===t})).every((function(e){return e in n.platform&&n.platform[e]})),i=t.map((function(e){return e.providerId})).filter((function(e,t,n){return n.indexOf(e)===t})).every((function(e){return e in n.provider&&n.provider[e]})),l=!1;if(e.endsWith("-1")||e.endsWith("-3")||e.endsWith("-t")){var a=e.endsWith("-1")?"one":e.endsWith("-3")?"three":"test";l=a in n.level&&n.level[a]}else{l=t.map((function(e){return e.providerId.includes("-level1-")?"one":e.providerId.includes("-level3-")?"three":e.providerId.includes("-test-")?"test":"none"})).filter((function(e,t,n){return n.indexOf(e)===t})).every((function(e){return e in n.level&&n.level[e]}))}return r||i||l?"":o.a.createElement(P,{domain:e,pools:t,filter:n,key:e})}},{key:"renderDebugData",value:function(){return window.location.hostname,""}},{key:"handleFilterChange",value:function(e){var t=this,n=e.target.id.split("_"),r=n[1],o=n[2];switch(r){case"platform":switch(o){case"aws":case"azure":this.setState((function(e){return e.filter.provider[o]=!e.filter.platform[o],e.filter.platform[o]=!e.filter.platform[o],t.props.history.push("#"+Object.keys(e.filter).filter((function(t){return Object.values(e.filter[t]).includes(!1)})).map((function(t){return t+"="+Object.keys(e.filter[t]).filter((function(n){return!e.filter[t][n]})).join()})).join(";")),e}));break;case"google":this.setState((function(e){return Object.keys(e.filter.provider).filter((function(e){return e.endsWith("-gcp")})).forEach((function(t){e.filter.provider[t]=!e.filter.platform[o]})),e.filter.platform[o]=!e.filter.platform[o],t.props.history.push("#"+Object.keys(e.filter).filter((function(t){return Object.values(e.filter[t]).includes(!1)})).map((function(t){return t+"="+Object.keys(e.filter[t]).filter((function(n){return!e.filter[t][n]})).join()})).join(";")),e}));break;case"deleted":this.setState((function(e){return e.filter.provider["null-provider"]=!e.filter.platform[o],e.filter.platform[o]=!e.filter.platform[o],t.props.history.push("#"+Object.keys(e.filter).filter((function(t){return Object.values(e.filter[t]).includes(!1)})).map((function(t){return t+"="+Object.keys(e.filter[t]).filter((function(n){return!e.filter[t][n]})).join()})).join(";")),e}));break;default:this.setState((function(e){return e.filter[r][o]=!e.filter[r][o],t.props.history.push("#"+Object.keys(e.filter).filter((function(t){return Object.values(e.filter[t]).includes(!1)})).map((function(t){return t+"="+Object.keys(e.filter[t]).filter((function(n){return!e.filter[t][n]})).join()})).join(";")),e}))}break;default:this.setState((function(e){return e.filter[r][o]=!e.filter[r][o],t.props.history.push("#"+Object.keys(e.filter).filter((function(t){return Object.values(e.filter[t]).includes(!1)})).map((function(t){return t+"="+Object.keys(e.filter[t]).filter((function(n){return!e.filter[t][n]})).join()})).join(";")),e}))}}},{key:"render",value:function(){var e=this;return o.a.createElement(g.a,null,o.a.createElement(w.a,null,o.a.createElement(y.a,{xs:10},o.a.createElement("h2",null,"taskcluster pools"),this.state.domains.map((function(t){return e.renderDomainSummaryComponent(t,e.state.pools[t],e.state.filter)}))),o.a.createElement(y.a,null,o.a.createElement("h5",null,"selection filters"),Object.keys(this.state.filter).map((function(t){return o.a.createElement(b.a,null,o.a.createElement("hr",null),o.a.createElement("h6",null,t,"s"),Object.keys(e.state.filter[t]).map((function(n){return o.a.createElement(b.a.Check,{type:"checkbox",onChange:e.handleFilterChange,checked:!e.state.filter[t][n],label:n,id:"filter_"+t+"_"+n,key:"filter_"+t+"_"+n})})))})),this.renderDebugData())))}}]),t}(r.Component)),S=Object(a.b)(z);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(62);var D=Object(s.a)();l.a.render(o.a.createElement(a.a,{history:D},o.a.createElement(S,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[46,1,2]]]);
//# sourceMappingURL=main.d52be277.chunk.js.map